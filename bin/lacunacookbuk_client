#!/usr/bin/env perl6

use v6;

use LacunaCookbuk::Client;
use Term::ANSIColor;

sub USAGE() {
say 'Usage:
  /home/kamil/dev/lacuna-cookbuk/bin/lacunacookbuk_client --help 
  /home/kamil/dev/lacuna-cookbuk/bin/lacunacookbuk_client --tasks=<Any> [--update]

Tasks should be separated by comma'; 

}


multi sub MAIN(Bool :$help!){
    USAGE();
    say "\nAvailable tasks" ~ (LacunaCookbuk::Client.^methods.map:{"\n\t" ~ colored(.gist, "bold") ~ ":\n\t\t " ~ .WHY ~ "\n"})
}

multi sub MAIN(Str :$tasks!, Bool :$update?){

  my LacunaCookbuk::Client $client .= new;
 
  create_session;

  my @todo=$tasks.split(/","/);

   if $update {
      LacunaCookbuk::Logic::BodyBuilder.process_all_bodies;
  } else {
      LacunaCookbuk::Logic::BodyBuilder.read;
  }

  for @todo -> $willdo {
      $client."$willdo"();
  }

  close_session;  
}


